# /tensorboard/form.yml.erb
<%-
  # get _list_partitions w/ GPUs
  p_cmd = "sinfo -ho %R,%G | awk -F, '/gpu/ {print $1}' | sort -u"
  begin
    output, status = Open3.capture2e(p_cmd)
    if status.success?
      _list_partitions = output.split("\n").map(&:strip).reject(&:blank?).sort
    else
      raise output
    end
  rescue => e
    _list_partitions = []
    p_error = e.message.strip
  end
-%>
---
cluster: "delta"

form:
  - modules
  - tb_logdir
#  - tb_extra_args
  - sh_partition
  - sh_num_cpus
  - sh_num_gpus
  - bc_num_memory
  - bc_duration
  - bc_account
  - bc_reservation
  - bc_email_on_started

attributes:

  modules: "anaconda3"

  tb_logdir:
    label: "Tensorboard logdir"
    required: true
    help: "The directory that contains data to visualize."

#  tb_extra_args:
#    label: "Additional TensorBoard arguments (optional)"

  sh_partition:
    label: "Partition"
    widget: "select"
    value: "cpu-interactive"
    help: "Interactive partitions are limited to 30 minutes."
    options:
      - ["cpu-interactive","cpu-interactive"]
      - ["gpuA100x4-interactive","gpuA100x4-interactive"]
      - ["gpuA40x4-interactive","gpuA40x4-interactive"]
      - ["cpu","cpu"]
      - ["gpuA100x4","gpuA100x4"]
      - ["gpuA40x4","gpuA40x4"]

  sh_num_cpus:
    label: "Number of CPUs"
    widget: "number_field"
    min: "1"

  sh_num_gpus:
    label: "Number of GPUs"
    widget: "number_field"
    min: "0"

  bc_num_memory:
    label: "Amount of RAM"
    widget: "text_field"
    help: "Use Slurm format, e.g. 4096M, 10G. If left blank, 1000 MB will be allocated per CPU core requested."

  bc_account:
    label: "Name of account"
    widget: "text_field"
    value: ""

  bc_reservation:
    label: "Name of reservation (leave empty if none)"
    widget: "text_field"
    value: ""

  bc_duration:
    label: "Duration of job"
    widget: "text_field"
    help: "Slurm format: DD-HH:MM:SS"
